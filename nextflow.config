params {
    fq_map = "fastq_map.tsv"
    parasite {
        fasta = "$projectDir/ref/PlasmoDB-44_Pfalciparum3D7_Genome.fasta"
        fasta_prefix = "$projectDir/ref/PlasmoDB-44_Pfalciparum3D7_Genome"
    }
    host{
        fasta = ["$projectDir/ref/host/hg38.fasta"]
        fasta_prefix = ["$projectDir/ref/host/hg38"]
    }
    known_sites = ["$projectDir/ref/known_snps_unsorted.vcf"]
    genome_intervals = ["Pf3D7_01_v3:1-320851", "Pf3D7_01_v3:320852-640851"]

    hard = true
    hard_filters = [
        [name: "QD.lt.2", filter: "QD<2.0"],
        [name: "FS.gt.60", filter: "FS>60.0"],
        [name: "MQ.lt.40", filter: "MQ<40.0"],
        [name: "MQRankSum.lt.-12.5", filter: "MQRankSum<-12.5"],
        [name: "ReadPosRankSum.lt.-8", filter: "ReadPosRankSum<-8.0"]
    ]

    vqsr = false
    vqsr_resources = [ 
        [name: 'jacob2014_microarray_liftover', type: 'truth', prior: 15, vcf: "$projectDir/ref/jacob2014_chip_sites.vcf" ], 
        [name: 'Pfcross1_3d7_hb3_gatk_pass', type: 'training', prior: 12, vcf: "$projectDir/ref/pf_crosses_v1/3d7_hb3.gatk.final.vcf.gz" ], 
        [name: 'Pfcross1_7g8_gb4_gatk_pass', type: 'training', prior: 12, vcf: "$projectDir/ref/pf_crosses_v1/7g8_gb4.gatk.final.vcf.gz" ], 
        [name: 'Pfcross1_hb3_dd2_gatk_pass', type: 'training', prior: 12, vcf: "$projectDir/ref/pf_crosses_v1/hb3_dd2.gatk.final.vcf.gz" ]
    ]
    vqsr_opts = "-an QD -an FS -an SOR -an DP --max-gaussians 3 --mq-cap-for-logit-jitter-transform 70 "
    vqsr_mode = "SNP"
    
    outdir = "result"
}

env {
    TMPDIR="/tmp"
}

executor {
    $local {
        queueSize = 5
        cpus = 20
        pollInterval = '30 sec'
    }

    $sge {
        queueSize = 400
        pollInterval = '30 sec'
        
    }
}

profiles{
    standard {
        executor = 'local'
        process {
            conda = "$projectDir/environment.yaml" 
            errorStrategy = {task.attempt < 5 ? 'retry': 'ignore'}
            maxRetries = 5
            cpus = 1
            memory = '5 GB'
        
            withName: 'BOWTIE2.*' {
                cpus = 3
            }
        
            withName: 'SAMTOOLS_FASTQ' {
                cpus = 3
            }
            withName: 'GATK_GENOMICS_DB_IMPORT' {
                cpus = 10
                memory = '50 GB'
            }
            withName: 'GATK_GENOTYPE_GVCFS' {
                cpus = 10
                memory = '50 GB'
            }
        }
    }
    test {
        executor = 'local'
        process {
            conda = "$projectDir/environment.yaml" 
            errorStrategy = {task.attempt < 5 ? 'retry': 'ignore'}
            maxRetries = 5
            cpus = 1
            memory = '2 GB'
        
            withName: 'BOWTIE2.*' {
                cpus = 2
            }
        
            withName: 'SAMTOOLS_FASTQ' {
                cpus = 2
            }
            withName: 'GATK_GENOMICS_DB_IMPORT' {
                cpus = 2
                memory = '5 GB'
            }
            withName: 'GATK_GENOTYPE_GVCFS' {
                cpus = 2 
                memory = '5 GB'
            }
        }
    }
    sge {
        executor = 'sge'
        process {
            conda = "$projectDir/environment.yaml" 
            errorStrategy = {task.attempt < 5 ? 'retry': 'ignore'}
            maxRetries = 5
            cpus = 1
            memory = '5 GB'

            queue = "threaded.q"
            penv = "thread"
            clusterOptions = "-P toconnor-lab -cwd -V"
        
            withName: "BOWTIE2.*" {
                cpus = 3
            }
        
            withName: 'SAMTOOLS_FASTQ' {
                cpus = 3
            }
            withName: 'GATK_GENOMICS_DB_IMPORT' {
                cpus = 10
                memory = '50 GB'
            }
            withName: 'GATK_GENOTYPE_GVCFS' {
                cpus = 10
                memory = '50 GB'
            }
        }
    }
}

manifest {
    name            = 'snp_call_nf'
    author          = 'Bing Guo'
    homePage        = 'https://github.com/xxx'
    description     = 'Nextflow plasmodium SNP call pipeline'
    mainScript      = 'main.nf'
    nextflowVersion = '>=21.04.0'
    version         = '0.1'
}

trace {
    enabled = true
    file = "${params.outdir}/pipeline_trace.txt"
    fields = 'task_id,name,status,exit,realtime,%cpu,rss'
}
